# Code Map (Deadtrees)

## WHEN TO USE
- Need a fast orientation to where functionality lives
- Deciding which module to edit or read

## API (FastAPI)
- Routers (HTTP layer):
  - `api/src/routers/upload.py`
  - `api/src/routers/download.py`
  - `api/src/routers/process.py`
  - `api/src/routers/labels.py`
  - `api/src/routers/auth.py`
- Upload business logic:
  - `api/src/upload/upload.py` (dataset creation)
  - `api/src/upload/raw_images_processor.py` (ZIP/raw images)
  - `api/src/upload/geotiff_processor.py` (GeoTIFF)
- Utilities:
  - `api/src/utils/file_utils.py`

## Processor (Orchestration & Processing)
- Orchestrator & queue:
  - `processor/src/processor.py`
  - `processor/src/continuous_processor.py`
- Processing tasks (function-first modules):
  - `processor/src/process_cog.py`
  - `processor/src/process_thumbnail.py`
  - `processor/src/process_metadata.py`
  - `processor/src/process_geotiff.py`
  - `processor/src/process_odm.py` (ODM)
  - `processor/src/process_deadwood_segmentation.py`
  - `processor/src/process_treecover_segmentation.py`
- GeoTIFF/COG utilities:
  - `processor/src/geotiff/standardise_geotiff.py`
  - `processor/src/cog/cog.py`
- Segmentation (models/inference):
  - `processor/src/deadwood_segmentation/*`
  - `processor/src/treecover_segmentation/predict_treecover.py`
  - `processor/src/treecover_segmentation/predict_pipeline.py`

## Processor Utils (Metadata & Data)
- `processor/src/utils/admin_levels.py` (GADM)
- `processor/src/utils/biome.py` (Biome dataset)
- `processor/src/utils/phenology.py` (Phenology Zarr)
- `processor/src/utils/ssh.py`, `processor/src/utils/shared_volume.py`

## Shared (Cross-cutting)
- `shared/settings.py` (env, paths, tables, endpoints)
- `shared/models.py` (Pydantic models)
- `shared/db.py` (Supabase client, auth helpers)
- `shared/logger.py`, `shared/logging.py`
- `shared/utils.py`, `shared/labels.py`, `shared/ortho.py`

## CLI
- `deadtrees-cli/deadtrees_cli/cli.py`
- `deadtrees-cli/deadtrees_cli/dev.py` (start/stop/test/debug/run-dev)
- `deadtrees-cli/deadtrees_cli/data.py` (data ops)

## Tests
- API tests: `api/tests/**`
- Processor tests: `processor/tests/**`
- CLI tests: `deadtrees-cli/tests/**`

## Compose & Infra
- Test stack: `docker-compose.test.yaml`
- Processor deploy: `docker-compose.processor.yaml`
- API+nginx deploy: `docker-compose.api.yaml`